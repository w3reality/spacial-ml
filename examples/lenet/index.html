<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <title>lenet</title>
</head>
<body>
    <canvas id="viewer" style="width: 100%; height: 100%;"></canvas>
    <div>
        For use in non VR mode, try - [left-mouse-drag: canvas stroke] [right-mouse-drag: cam translate] [mouse-wheel: cam translate fw/bw]
    </div>

    <script src="../deps/stats.min.js"></script>
    <script src="../deps/three.min.js"></script>
    <script src="../deps/OrbitControls.js"></script>
    <script src="../deps/WebVR.js"></script>
    <script src="../deps/Sky.js"></script>
    <script src="../deps/threelet.min.js"></script>
    <script src="../deps/signature_pad.min.js"></script>

    <script src="../deps/tween.min.js"></script>
    <script src="../deps/tf.min.js"></script>
    <script src="../deps/TrackballControls.js"></script>
    <script src="../deps/tensorspace.min.js"></script>

    <script type="module">
    import Viewer from '../../src/viewer.js';

    const createLenet = () => {
        // build LeNet following
        // https://github.com/tensorspace-team/tensorspace/blob/master/examples/lenet/lenet.html
        const model = new TSP.models.Sequential(document.createElement('div'));
        model.add( new TSP.layers.GreyscaleInput({ shape: [28, 28, 1] }) );
        model.add( new TSP.layers.Padding2d({ padding: [2, 2] }) );
        model.add( new TSP.layers.Conv2d({ kernelSize: 5, filters: 6, strides: 1 }) );
        model.add( new TSP.layers.Pooling2d({ poolSize: [2, 2], strides: [2, 2] }) );
        model.add( new TSP.layers.Conv2d({ kernelSize: 5, filters: 16, strides: 1 }) );
        model.add( new TSP.layers.Pooling2d({ poolSize: [2, 2], strides: [2, 2] }) );
        model.add( new TSP.layers.Dense({ units: 120 }) );
        model.add( new TSP.layers.Dense({ units: 84 }) );
        model.add( new TSP.layers.Output1d({ units: 10, outputs: ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"] }));
        console.log('@@ model:', model);
        model.load({
            type: 'tfjs',
            url: './data/mnist.json',
            onComplete: () => { // to be called on init() !!!!
                console.log('@@ onComplete(): hi, on init()');
            },
        });
        return model;
    };

    const viewer = new Viewer({
        canvas: document.getElementById("viewer"),
        optAxes: false,
    });
    viewer.loadML('lenet', createLenet());

    viewer.updateLoop(30);
    // viewer.updateLoop(3); // debug
    </script>
</body>
</html>
