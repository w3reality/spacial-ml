window.TspAdapter = (function () { var exports = {};
"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),__AframeModelComponent=function __AframeModelComponent(){_classCallCheck(this,__AframeModelComponent),Object.assign(this,{schema:{axes:{type:"boolean",default:!1}},init:function(){if(this.data.axes){var scene=this.el.object3D,fixRotScaleMesh=function(obj){var scale=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return obj.rotation.z=Math.PI,obj.rotation.x=-Math.PI/2,obj.scale.set(scale,scale,scale),obj.updateMatrixWorld(),obj},walls=function(){var size=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,1,1],color=arguments.length>1&&void 0!==arguments[1]?arguments[1]:13421772;return new THREE.LineSegments(new THREE.EdgesGeometry(new(Function.prototype.bind.apply(THREE.BoxBufferGeometry,[null].concat(_toConsumableArray(size))))),new THREE.LineBasicMaterial({color:color}))}();walls.position.set(0,0,0),scene.add(fixRotScaleMesh(walls,1));var axes=new THREE.AxesHelper(2);scene.add(fixRotScaleMesh(axes,1))}}})},__AframeColliderComponent=function __AframeColliderComponent(adapter){_classCallCheck(this,__AframeColliderComponent),Object.assign(this,{dependencies:["raycaster"],tick:function(){adapter.onUpdate()},init:function(){this.el.addEventListener("click",function(evt){if(evt.detail.intersection){var isects=[evt.detail.intersection];adapter.onHover(isects),adapter.onClick(isects),setTimeout(function(){adapter._refreshAframeModel()},3e3)}}),this.el.addEventListener("raycaster-intersection",function(evt){var isects=evt.detail.intersections.slice();adapter.onHover(isects)}),this.el.addEventListener("raycaster-intersection-cleared",function(evt){adapter.onHover([])})}})},TspAdapter=function(){function TspAdapter(){var opts=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,TspAdapter),this.modelContext=null,this.onUpdate=function(){},this.onHover=function(isects){},this.onClick=function(isects){},this.aframeModelComponentName=opts.aframeModelComponentName}return _createClass(TspAdapter,[{key:"setModel",value:function(model){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var mr=model.modelRenderer;if(!mr)throw"TspAdapter: error: [hint] setModel() must be called after model.init()";var mc=model.modelContext;if(this.modelContext=mc,this.aframeModelComponentName){var el=this._getAframeModelElement();el&&el.object3D.add(mc),this._refreshAframeModel()}return mc.position.set(0,0,0),mc.rotation.x=-Math.PI/2,mc.rotation.z=Math.PI/2,mc.scale.set(.01,.01,.01),mr.animate=function(){},this.onUpdate=function(){window.TWEEN.update()},this.onHover=function(isects){mr.handlers.handleHover(isects)},this.onClick=function(isects){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=isects[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var isec=_step.value;if(isec&&"Mesh"===isec.object.type&&!0===isec.object.clickable){mr.handlers.handleClick(isec.object);break}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}},mc}},{key:"createAframeModelComponent",value:function(){return new __AframeModelComponent}},{key:"createAframeColliderComponent",value:function(){return new __AframeColliderComponent(this)}},{key:"_getAframeModelElement",value:function(){var comName=this.aframeModelComponentName;return comName?document.querySelectorAll("["+comName+"]")[0]:null}},{key:"_refreshAframeModel",value:function(){var el=this._getAframeModelElement(),mc=this.modelContext;el&&mc&&el.setObject3D("mc-"+mc.uuid,mc)}}]),TspAdapter}();exports.default=TspAdapter;
return TspAdapter; })();
